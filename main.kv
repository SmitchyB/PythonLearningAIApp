ScreenManager:
    LoginScreen:
    MainScreen:
    LessonScreen:
    ProfileScreen:
    MistakesScreen:
    QuestionScreen:
    ChapterReviewScreen:
    CumulativeReviewScreen:

<LoginScreen>:
    name: "login"
    AnchorLayout:  # Wrap everything in an AnchorLayout for centering
        anchor_x: 'center'
        anchor_y: 'center'
        BoxLayout:
            orientation: 'vertical'
            size_hint: 0.8, None  # Adjusts for mobile scaling
            height: self.minimum_height
            padding: 20
            spacing: 10
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1  # Slightly lighter black background
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [10]
            
            Label:
                id: form_label
                text: "Login"
                font_size: 24
                size_hint_y: None
                height: 30

            TextInput:
                id: name_input
                hint_text: "Name"
                multiline: False
                size_hint_x: 1
                size_hint_y: None
                height: 30
                opacity: 0 if root.ids.main_button.text == "Login" else 1

            TextInput:
                id: username
                hint_text: "Email"
                multiline: False
                size_hint_x: 1
                size_hint_y: None
                height: 30

            TextInput:
                id: password
                hint_text: "Password"
                password: True
                multiline: False
                size_hint_x: 1
                size_hint_y: None
                height: 30

            Button:
                id: main_button
                text: "Login"
                size_hint_x: 1
                size_hint_y: None
                height: 40
                on_press: root.authenticate_or_register(root.ids.name_input.text, username.text, password.text)

            Label:
                id: message_label
                text: ""
                size_hint_y: None
                height: 30
                size_hint_x: 1
                color: (1, 0, 0, 1)  # Red color for error messages (optional)

            Label:
                id: switch_text
                text: "[color=0000FF][ref=toggle]Not Registered? Register Here[/ref][/color]"
                markup: True
                size_hint_y: None
                height: 30
                size_hint_x: 1
                on_ref_press: root.toggle_form()

<MainScreen>:
    name: "main"
    BoxLayout:
        orientation: 'vertical'

        # Header Area (Retained)
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 50
            padding: [10, 10]
            spacing: 10
            canvas.before:
                Color:
                    rgba: 0.1, 0.1, 0.1, 1
                Rectangle:
                    size: self.size
                    pos: self.pos
            Button:
                size_hint: None, None
                width: 40
                height: 40
                background_normal: ''
                canvas.before:
                    Color:
                        rgba: 0.7, 0.7, 0.7, 1
                    Ellipse:
                        size: self.size
                        pos: self.pos
            Widget:
            Button:
                text: "Mistakes"
                size_hint_x: None
                width: self.texture_size[0] + 20
                on_press: root.manager.current = "mistakes"
            Button:
                text: "Profile"
                size_hint_x: None
                width: self.texture_size[0] + 20
                on_press: root.manager.current = "profile"
            Button:
                text: "Logout"
                size_hint_x: None
                width: self.texture_size[0] + 20
                on_press: root.manager.current = "login"

        # Vertical Scrollable Area for Chapters and Lessons
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            bar_width: 10  # Optional: set scrollbar width for visibility
            BoxLayout:
                id: roadmap_layout
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height  # Dynamically adjust height
                spacing: 10  # Adjust spacing if necessary
                padding: [10, 10, 10, 20]  # Padding (left, top, right, bottom)

<LessonScreen>:
    name: "lesson"
    BoxLayout:
        orientation: 'vertical'
        padding: [10, 10, 10, 10]
        spacing: 10
        BoxLayout:
            size_hint_y: 0.1
            Button:
                text: "Back"
                size_hint: (None, None)
                size: (100, 40)
                pos_hint: {"left": 1}
                on_press: root.manager.current = "main"

        BoxLayout:
            orientation: 'horizontal'
            RelativeLayout:
                Label:
                    id: lesson_content
                    text: "Lesson Content Here"
                    text_size: self.width - 55, None  # Ensure text wraps within specified width
                    halign: 'center'  # Default alignment
                    valign: 'middle'  # Default alignment
                    padding: [30, 20]
                    height: min(self.texture_size[1], self.parent.height - 50)  # Limit height dynamically
                    width: self.parent.width - 40  # Ensure width fits within parent
                    color: 1, 1, 1, 1  # Change text color to white for visibility on a black background

        BoxLayout:
            size_hint_y: 0.2
            orientation: 'horizontal'
            padding: [20, 0, 20, 0]
            spacing: 20
            Button:
                text: "Back"
                size_hint: (None, None)
                size: (100, 40)
                on_press: root.previous_lesson_part()
                id: back_button
                opacity: 0  # Initially hidden
                disabled: True  # Initially disabled

            Button:
                text: "Next"
                size_hint: (None, None)
                size: (100, 40)
                on_press: root.next_lesson_part()

<ProfileScreen>
    name: "profile"
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: username
            text: "Username:"

<MistakesScreen>:
    name: "mistakes"
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: mistakes
            text: "Mistakes:"

<QuestionScreen>:
    name: "questions"
    BoxLayout:
        orientation: 'vertical'
        padding: [10, 10, 10, 10]
        spacing: 10

        # Back Button Area
        BoxLayout:
            size_hint_y: 0.1
            Button:
                text: "Back"
                size_hint: (None, None)
                size: (100, 40)
                pos_hint: {"left": 1}
                on_press: root.manager.current = "main"

        # Question Content Area
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.4  # Adjust size as needed
            padding: [10, 10, 10, 10]
            Label:
                id: question_content
                text: "Your question text here"
                text_size: self.width, None
                size_hint_y: None
                height: self.texture_size[1]
                valign: "top"
                halign: "left"
                padding: 10, 10

        # Feedback Label Area (Below Question)
        Label:
            id: feedback_label
            text: ""
            size_hint_y: None
            height: self.texture_size[1]
            color: (1, 0, 0, 1)  # Initial color for incorrect feedback (red)
            text_size: self.width, None  # Ensures text wraps within the width
            valign: 'middle'
            halign: 'left'

        # Answer Area with Options
        BoxLayout:
            id: answer_area
            orientation: 'horizontal'
            size_hint_y: 0.3  # Adjust size as needed
            spacing: 10
            padding: [10, 0, 10, 0]

        # Submit Button Area
        BoxLayout:
            size_hint_y: None
            height: 40
            Button:
                text: "Submit"
                size_hint: (None, None)
                size: (100, 40)
                on_press: root.submit_answer() 

<ChapterReviewScreen>

<CumulativeReviewScreen>

